<!DOCTYPE html>
<html lang="zh-Hant">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0"> 
    <title>201實驗班專用POS系統</title>
    
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/all.min.css">
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    
    <link rel="stylesheet" href="css/common.css">
    <link rel="stylesheet" href="css/frontend/layout.css">
    <link rel="stylesheet" href="css/frontend/products.css">
    <link rel="stylesheet" href="css/frontend/order.css">
    <link rel="stylesheet" href="css/frontend/modals.css">
</head>
<body>

    <div id="splash-screen">
        <div class="splash-content">
            <i class="fas fa-cash-register"></i>
            <h1>201實驗班專用POS系統</h1>
            <div class="splash-spinner"></div>
        </div>
    </div>
    <div id="employee-selection-modal" class="modal" role="dialog" aria-modal="true" aria-labelledby="employee-modal-title">
        <div class="modal-content">
            <h1 id="employee-modal-title">請選擇值班人員</h1>
            <div id="loading-message" class="loading-message" role="status">
                <i class="fas fa-spinner fa-spin"></i> 正在載入員工資料...
            </div>
            <div id="employee-list" class="employee-grid">
            </div> 
        </div>
    </div>

    <div id="checkout-modal" class="modal" role="dialog" aria-modal="true" aria-labelledby="checkout-modal-title">
        <div class="modal-content">
            <button class="close-btn" id="close-checkout-modal" aria-label="關閉結帳視窗">&times;</button>
            <h1 id="checkout-modal-title">結帳確認</h1>
            <div class="checkout-summary">
                <div class="summary-row">
                    <span>訂單總額 (應付):</span>
                    <span id="summary-total-amount" class="text-large text-danger">NT$ 0</span>
                </div>
            </div>
            <div class="payment-area">
                <label for="paid-amount">顧客支付金額:</label>
                <input type="number" id="paid-amount" value="0" min="0" step="1" required pattern="[0-9]*" inputmode="numeric" aria-required="true">
            </div>
            <div class="change-display">
                <div class="summary-row">
                    <span>找零金額:</span>
                    <span id="summary-change-amount" class="text-large text-success">NT$ 0</span>
                </div>
            </div>
            <p id="checkout-error-message" class="text-danger hidden" role="alert">支付金額不足！</p>
            <div class="checkout-actions">
                <button id="final-confirm-btn" class="checkout-button" aria-label="確認結帳並將交易記錄入帳">
                    <i class="fas fa-check"></i> 確認結帳
                </button>
            </div>
        </div>
    </div>
    
    <div id="hold-retrieve-modal" class="modal" role="dialog" aria-modal="true" aria-labelledby="hold-modal-title">
        <div class="modal-content">
            <button class="close-btn" id="close-hold-modal" aria-label="關閉視窗">&times;</button>
            <h1 id="hold-modal-title">暫掛 / 取單管理</h1>
            
            <div id="hold-order-input-section" class="hold-input-section">
                <label for="hold-order-name">為目前訂單命名：</label>
                <div class="input-group">
                    <input type="text" id="hold-order-name" placeholder="例如: 1號桌 / 客人忘記帶錢">
                    <button id="save-held-order-btn" class="btn-primary">
                        <i class="fas fa-save"></i> 儲存目前訂單
                    </button>
                </div>
                <p id="hold-order-error" class="error-message hidden" style="text-align: left; margin-top: 5px;">請先輸入名稱</p>
            </div>
            
            <h2 class="hold-list-title">
                <i class="fas fa-list-ul"></i> 已暫掛的訂單
            </h2>
            
            <div id="held-order-list-container" class="held-order-list-container">
            </div>
        </div>
    </div>
    
    <div id="stock-warning-modal" class="modal" role="dialog" aria-modal="true" aria-labelledby="warning-modal-title">
        <div class="modal-content">
            <button class="close-btn" id="close-warning-modal" aria-label="關閉預警視窗">&times;</button>
            <h1 id="warning-modal-title">低庫存商品</h1>
            <p style="margin-top: -10px; margin-bottom: 20px;">以下商品庫存已低於預警門檻，請盡快補貨。</p>
            
            <div class="held-order-list-container" id="stock-warning-list-container">
                <table id="stock-warning-table">
                    <thead>
                        <tr>
                            <th>商品名稱</th>
                            <th>目前庫存</th>
                            <th>預警門檻</th>
                        </tr>
                    </thead>
                    <tbody id="stock-warning-tbody">
                        </tbody>
                </table>
            </div>
        </div>
    </div>
    
    <div id="discount-modal" class="modal" role="dialog" aria-modal="true" aria-labelledby="discount-modal-title">
        <div class="modal-content large">
            <button class="close-btn" id="close-discount-modal" aria-label="關閉折扣視窗">&times;</button>
            <h1 id="discount-modal-title">套用折扣</h1>
            
            <div class="discount-modal-body">
                <div class="discount-section">
                    <h2><i class="fas fa-check-circle"></i> 可用折扣</h2>
                    <div id="applicable-discounts-list" class="discount-list-container">
                    </div>
                </div>
                <div class="discount-section">
                    <h2 class="disabled"><i class="fas fa-times-circle"></i> 不可用折扣 (未達條件)</h2>
                    <div id="inapplicable-discounts-list" class="discount-list-container disabled">
                    </div>
                </div>
            </div>

            <div class="discount-modal-footer">
                <div class="summary-row">
                    <span>小計:</span>
                    <span id="modal-subtotal">NT$ 0</span>
                </div>
                <div class="summary-row applied">
                    <span>已套用折扣:</span>
                    <span id="modal-discount-total">NT$ 0</span>
                </div>
                <div class="summary-row final">
                    <span>結帳金額:</span>
                    <span id="modal-final-total">NT$ 0</span>
                </div>
            </div>
        </div>
    </div>

    <div id="alert-modal" class="modal" role="dialog" aria-modal="true" aria-labelledby="alert-modal-title">
        <div class="modal-content small fail"> <div class="fail-icon">
                <i class="fas fa-times"></i>
            </div>
            
            <h1 id="alert-modal-title">錯誤</h1>
            <p id="alert-modal-message">這是一條錯誤訊息。</p>
            
            <div class="modal-actions">
                <button id="alert-modal-confirm" class="btn-danger">確認 (Enter)</button>
            </div>
        </div>
    </div>
    
    <div id="checkout-success-modal" class="modal" role="dialog" aria-modal="true" aria-labelledby="success-modal-title">
        <div class="modal-content success">
            <div class="success-icon">
                <i class="fas fa-check"></i>
            </div>
            <h1 id="success-modal-title">結帳成功</h1>
            <p id="success-order-id">訂單號碼: #0000</p>
            
            <div class="success-receipt">
                <div class="summary-row">
                    <span>應付金額:</span>
                    <span id="success-total">NT$ 0</span>
                </div>
                <div class="summary-row">
                    <span>支付金額:</span>
                    <span id="success-paid">NT$ 0</span>
                </div>
                <div class="summary-row change">
                    <span>找零金額:</span>
                    <span id="success-change">NT$ 0</span>
                </div>
            </div>
            
            <div class="modal-actions">
                <button id="success-modal-confirm" class="btn-primary">完成 (Enter)</button>
            </div>
        </div>
    </div>


    <header class="pos-header">
        <div class="employee-info">
            <small class="designer-note">Website designed by Yang</small>
            <span id="current-employee-display" role="status" aria-live="polite">
                <i class="fas fa-user-circle"></i> 請先選擇值班人員
            </span>
        </div>
        <h1 class="system-title">
            <i class="fas fa-cash-register"></i> 201實驗班專用POS系統
        </h1>
        <div class="utility-info">
            <time id="current-time"></time>
            
            <div class="notification-bell" id="stock-warning-bell" title="低庫存商品">
                <span>🔔</span>
                <div class="notification-dot" id="stock-warning-dot"></div>
            </div>

            <button id="go-to-backend-btn" class="backend-button" title="前往商品、庫存、員工管理介面" aria-label="後台管理介面">
                <i class="fas fa-chart-line"></i> 後台管理
            </button>
            <button id="change-employee-btn" class="backend-button" title="切換員工/登出" aria-label="切換員工">
                <i class="fas fa-user-cog"></i> 切換員工
            </button>
        </div>
    </header>

    <div id="pos-main-app" class="pos-app hidden">
        <main class="pos-content">
            
            <section class="product-selection-area" aria-labelledby="product-list-heading">
                
                <div id="category-tabs" class="category-tabs" role="tablist">
                    </div>

                <p id="product-loading-message" class="loading-message" aria-live="polite" style="display: none;">
                    <i class="fas fa-box-open"></i> 正在載入商品資料...
                </p>

                <div id="product-list" class="product-grid" role="list">
                    </div>

            </section>

            <aside class="order-summary-area"> 
                
                <div class="order-header">
                    <h2><i class="fas fa-receipt"></i> 訂單明細</h2>
                    <div class="order-header-actions">
                        <div class="system-buttons">
                            <button id="hold-order-btn" class="system-button">
                                <i class="fas fa-pause-circle"></i> 暫掛
                            </button>
                            <button id="retrieve-order-btn" class="system-button">
                                <i class="fas fa-play-circle"></i> 取單
                                <span id="held-order-count" class="held-order-count hidden">0</span>
                            </button>
                        </div>
                        <button id="clear-order-btn" class="clear-button" title="清空訂單" aria-label="清空目前訂單">
                            <i class="fas fa-trash-alt"></i> 清空
                        </button>
                    </div>
                </div>

                <div id="order-items-list-container" class="order-items-list-container" role="region" aria-label="訂單項目列表">
                    <table>
                        <thead>
                            <tr>
                                <th scope="col">品項</th>
                                <th scope="col">單價</th>
                                <th scope="col">數量</th>
                                <th scope="col">總額</th>
                                <th scope="col">移除</th> 
                            </tr>
                        </thead>
                        <tbody id="order-items-table-body">
                            <tr>
                                <td colspan="5" class="empty-order-message">尚未加入商品</td>
                            </tr>
                        </tbody>
                    </table>
                </div>

                <div class="order-totals">
                    <div class="total-row-quantity">
                        <dt>總數量:</dt>
                        <dd id="order-item-count">0</dd>
                    </div>
                    <div class="total-row">
                        <dt>小計:</dt>
                        <dd id="order-subtotal">NT$ 0</dd>
                    </div>
                    <div class="total-row discount-row">
                        <dt>折扣:</dt>
                        <dd id="order-discount">
                            <button id="open-discount-modal-btn" class="discount-button" disabled>
                                <i class="fas fa-tags"></i> 套用折扣
                            </button>
                        </dd>
                    </div>
                    <div class="total-row final-total-row">
                        <dt>應付金額:</dt>
                        <dd id="order-final-total">NT$ 0</dd>
                    </div>
                </div>
                
                <div class="checkout-area">
                    <button id="checkout-btn" class="checkout-button" disabled data-total="0" aria-label="結帳並進入付款流程">
                        <i class="fas fa-coins"></i> 結帳 
                    </button>
                </div>
            </aside>

        </main>
    </div> 
    
    <script src="js/frontend/main.js" type="module"></script>
</body> 
</html>